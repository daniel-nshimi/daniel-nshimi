import mysql.connector
import pandas as pd
from mysql.connector import Error
import xlrd
df = pd.read_excel(r"C:\Users\Dnshimiyimana\Desktop\INKOMOKO\Kak_endline_Test_revised_2_SQL_SERVER_REVISED1.xlsx")
try:
    conn = mysql.connector.connect(host='localhost', database='inkomoko', user='root', passwd='root')
    if conn.is_connected():
        cursor = conn.cursor()
        cursor.execute("select database();")
        record = cursor.fetchone()
        print("You're connected to database: ", record)
        cursor.execute('DROP TABLE IF EXISTS Kak_Baseline_Test_revised;')
        print('Creating table....')
        cursor.execute("CREATE TABLE Kak_endline(unique_id varchar(50) ,cd_gender text ,cd_nationality text ,cd_strata text ,cd_age float ,client_location text ,bd_location text ,cd_enum_name text ,consent_yesno float ,cd_education text ,cd_strata1 text ,cd_trial_group_confirm float ,cd_location_change text ,cd_location text ,cd_location_otr varchar(2550),bd_earner_only text , bd_members_respfor float ,sect_B varchar(2550),bd_biz_operational varchar(2550),bd_bizname varchar(2550),bd_location_change text ,bd_location1 text ,bd_newproduct varchar(2550),bd_newproduct_reason float ,bd_elec_devices_yesno text ,e_fulltime_employees float ,e_parttime_employees float ,e_casual_employees float ,e_total_employees float ,e_male_employees float ,e_female_employees float ,e_male_female_total float ,e_employees_35below float ,e_employees_36above float ,e_employees_age_total float ,e_related_employees float ,e_refugees_employees float ,section_D text ,sr_bank_account text ,sr_pri_inc_sourcs text ,sr_access_newfunds text ,sr_access float ,sr_access_1 float ,sr_access_2 text ,sr_access_3 text ,sr_access_4 text ,sr_access_5 text ,sr_access_6 text ,sr_access_7 text ,sr_access_8 text ,sr_access_9 text ,sr_access_10 text ,sr_access_no float ,sr_aec_finance_help text ,sr_customers_hwmny float ,sr_customers_main float ,sr_customers_main_1 text ,sr_mnthly_sales_total float ,sr_aec_revenue_help text ,sr_fluctuations varchar(2550),sr_revstreams_most varchar(2550),sr_revstreams_mostJanuary float  ,sr_revstreams_mostFebruary float ,sr_revstreams_mostMarch float ,sr_revstreams_mostApril float ,sr_revstreams_mostMay float ,sr_revstreams_mostJune float ,sr_revstreams_mostJuly float ,sr_revstreams_mostAugust float ,sr_revstreams_mostSeptember float ,sr_revstreams_mostOctober float ,sr_revstreams_mostNovember float ,sr_revstreams_mostDecember float ,sr_revstreams_least text ,sr_revstreams_leastJanuary float ,sr_revstreams_leastFebruary float ,sr_revstreams_leastMarch float ,sr_revstreams_leastApril float ,sr_revstreams_leastMay float ,sr_revstreams_leastJune float ,sr_revstreams_leastJuly float ,sr_revstreams_leastAugust float ,sr_revstreams_leastSeptember float ,sr_revstreams_leastOctober float ,sr_revstreams_leastNovember float,sr_revstreams_leastDecember float ,sr_bizchallenges float ,sr_bizchallenges_1 text ,sr_bizchallenges_3 text ,sr_bizsupport float ,sr_bizsupport_1 text ,sr_records_keep_base text ,sr_records_keep text ,asr_services text ,asr_services_1 text ,asr_services_2 text ,asr_services_3 text ,asr_training_attnd text ,asr_training_not_attnd_1 text ,asr_bda text ,asr_bda_visit float ,asr_bda_time text ,asr_bda_comm text ,asr_bda_service text ,asr_bda_service_wht text ,asr_bda_service_improve text ,asr_bda_service_imp_yes text ,asr_aec_empsklls_help text ,asr_training_useful text ,asr_otheractivities_help text ,explanation text ,rating_options text ,knwrate_sales float ,knwrate_marketing float ,knwrate_ops_mgt float ,knwrate_bkeeping float ,knwrate_financialmgt float ,knwrate_cashflow float ,knwrate_invent_mgt float ,knwrate_bizplanning float ,knwrate_access_finance float ,knwrate_doing_bizkenya float ,section_G text ,liv_hwmuch_UNHCRstip text ,liv_expnsefood_fam float ,liv_expnseschl_3mnths float ,liv_expnselectricity float ,liv_expnsecooking float ,liv_sec_inc text ,liv_sec_inc_source float ,liv_sec_inc_source_1 varchar(255) ,liv_assetsbght_4mnths float ,liv_sgmembership text ,liv_sgmembership_no_saveany text ,liv_sgno_saveany_hw float ,liv_sgno_saveany_hwmuch float ,liv_livingcond_change text ,liv_meals_number_base text ,liv_meals_number_end text ,liv_meals_skip_base text ,liv_meals_skip_end text ,liv_meals_meat text ,liv_cookingfuel text ,ss_aecscrvcs_satisfied_rate text ,ss_aecscrvcs_recommend float ,ss_partofprogram_again text ,end_comment text  )")
        print("Table is created....")
        for i,row in df.iterrows():
            print(len(df))
            sql = 'INSERT INTO inkomoko.Kak_Baseline_Test_revised VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)'
            cursor.execute(sql, tuple(row))
            print("Record inserted")
            conn.commit()
except Error as e:
            print("Error while connecting to MySQL", e)
